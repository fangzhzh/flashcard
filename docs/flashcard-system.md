# Flashcard & Deck Management System

FlashFlow provides a comprehensive system for creating, organizing, and reviewing study materials, centered around flashcards and decks. The data is managed primarily through the `FlashcardsContext` and user interactions are handled by several client components.

## 1. Data Models

### a. Flashcard

```typescript
interface Flashcard {
  id: string;
  front: string; // Supports Markdown
  back: string;  // Supports Markdown, Mermaid, and Markmap
  lastReviewed: string | null;
  nextReviewDate: string | null;
  interval: number; // Spacing interval in days
  status: 'new' | 'learning' | 'mastered';
  deckId?: string | null;
}
```

### b. Deck

```typescript
interface Deck {
  id: string;
  name: string;
  userId: string;
}
```

## 2. Rich Content Support

A key feature of FlashFlow is its support for rich content within flashcards, rendered using `react-markdown`.

-   **Markdown**: Both the `front` and `back` of a flashcard support standard GitHub-flavored Markdown, allowing for formatting, lists, links, images, and more.
-   **Mermaid Diagrams**: To render a Mermaid diagram, a user includes a Markdown code block with the `mermaid` language identifier.
    ````
    ```mermaid
    graph TD;
        A-->B;
        A-->C;
    ```
    ````
    The `MermaidDiagram.tsx` component detects this and uses the `mermaid` library to render the SVG chart.
-   **Markmaps (Mindmaps)**: The `back` of a card can be rendered as a fullscreen, interactive mindmap. This is triggered by a "View Mindmap" button.
    -   **Component**: `MarkmapRenderer.tsx`
    -   **Logic**: The component uses the `markmap-lib` transformer to convert the Markdown content into a data structure that `markmap-view` can render as an SVG mindmap.

## 3. CRUD Operations & UI

-   **Decks**: `DecksClient.tsx` handles the creation, renaming, and deletion of decks. Deleting a deck also deletes all flashcards contained within it, handled via a Firestore transaction.
-   **Flashcards**:
    -   `FlashcardListClient.tsx` displays all cards or cards filtered by a specific deck.
    -   `FlashcardItem.tsx` represents a single card, providing options to edit, delete, or flip to see the back.
    -   `FlashcardFormPage.tsx` and the `FlashcardForm.tsx` component provide the interface for creating and editing cards.

### a. Batch Creation

-   **Component**: `BatchFlashcardForm.tsx`
-   **Functionality**: To speed up content entry, users can switch to a batch creation mode.
-   **Format**: Users provide a list of flashcards in a simple `question:answer` text format, with one card per line.
    ```
    What is the capital of Japan?:Tokyo
    What is 2^10?:1024
    ```
-   **Logic**: The `handleBatchSubmit` function splits the input by newlines, then splits each line by the first colon to get the front and back content. It performs basic validation to ensure neither part is empty before creating the flashcards in a batch.

## 4. Spaced Repetition System (SRS)

FlashFlow implements a simple but effective SRS algorithm to schedule card reviews.

-   **Component**: `ReviewModeClient.tsx`
-   **Trigger**: The "Start Review" button on the dashboard or on a deck card.
-   **Core Logic**: When a user reviews a card and rates their performance, the `handleProgress` function calculates the next review date.
    -   **`nextReviewDate`**: The date on which the card will become "due".
    -   **`interval`**: The number of days to wait before the next review.

### a. Algorithm

The `interval` is adjusted based on the user's rating:

1.  **Try Again**: The card was difficult.
    -   The `interval` is reset to `1` day.
    -   The card's `status` is set to `learning`.

2.  **Later**: The user recalled the answer, but with some hesitation.
    -   `newInterval = currentInterval * 1.3`
    -   The `status` is set to `learning`.

3.  **Mastered**: The user recalled the answer easily.
    -   `newInterval = currentInterval * 2.0`
    -   The `status` is set to `mastered` if the interval is sufficiently large, otherwise it remains `learning`. (Note: The simplified implementation sets it to `mastered` on this rating).

A minimum interval of 1 day and a maximum of 365 days are enforced.

### b. Review Queue Generation

-   **Function**: `getReviewQueue()` in `FlashcardsContext.tsx`.
-   **Logic**: The review queue includes all cards where:
    1.  The `status` is **not** `mastered`.
    2.  The `nextReviewDate` is today or in the past.
-   The queue is sorted to prioritize cards with the earliest `nextReviewDate`.

### c. Flexible Review Modes

`ReviewModeClient.tsx` supports two session types:

1.  **Spaced Repetition Mode**: This is the default mode. It uses the queue generated by `getReviewQueue()`, showing the user only the cards that are currently due.
2.  **Review All Mode**: This mode ignores the SRS schedule and creates a shuffled queue of *all* cards (either in the entire collection or within a specific deck), allowing the user to practice everything at once.
